═══════════════════════════════════════════════════════════════════════════
              RAPPORT D'IDENTIFICATION DES FAIBLESSES DU SYSTÈME NLU
═══════════════════════════════════════════════════════════════════════════

Date: 2025-12-06
Tests exécutés: 40
Tests passés: 36/40 (90%)
Tests échoués: 4/40 (10%)

═══════════════════════════════════════════════════════════════════════════
RÉSUMÉ EXÉCUTIF
═══════════════════════════════════════════════════════════════════════════

Le système NLU v2 est ROBUSTE sur la grande majorité des cas (90% de réussite).
Les 4 échecs identifiés révèlent des améliorations spécifiques à apporter:

✅ POINTS FORTS:
   - Détection d'acronymes excellente (TCC, AVP, RDN+, GCS, etc.)
   - Validation numérique fièvre parfaite (seuil ≥38°C)
   - Gestion cas extrêmes correcte (âge centenaire, texte long, etc.)
   - Cas cliniques gold standard 100% détectés

⚠️  FAIBLESSES IDENTIFIÉES:
   1. Négations avec contexte temporel ("pas hier MAIS aujourd'hui")
   2. Déclencheurs HTIC ("toux/effort") non reconnus
   3. Négations suivies d'exceptions ("sans... sauf...")
   4. Durées "3 semaines" mal catégorisées (acute vs subacute)

═══════════════════════════════════════════════════════════════════════════
SECTION 1: TESTS ÉCHOUÉS (4 FAIBLESSES CRITIQUES)
═══════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────┐
│ FAIBLESSE #1: Négation suivie d'exception                              │
├─────────────────────────────────────────────────────────────────────────┤
│ Test: test_sans_deficit_MAIS_hemiparesie                               │
│ Texte: "Sans déficit neurologique, mais hémiparésie droite 3/5"        │
│                                                                         │
│ ATTENDU: neuro_deficit = True (hémiparésie doit primer)                │
│ OBTENU:  neuro_deficit = None                                          │
│                                                                         │
│ CAUSE:                                                                  │
│ - "sans déficit" déclenche négation                                    │
│ - "hémiparésie" ensuite n'est pas détectée                             │
│ - Négation bloque détections suivantes                                 │
│                                                                         │
│ SOLUTION À IMPLÉMENTER:                                                 │
│ - Détecter les marqueurs d'exception: "mais", "cependant", "sauf"      │
│ - Invalider négation si exception suit                                 │
│ - Ou: donner priorité aux termes positifs sur négatifs                 │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│ FAIBLESSE #2: Déclencheurs HTIC non reconnus                           │
├─────────────────────────────────────────────────────────────────────────┤
│ Test: test_cephalee_tussigene                                          │
│ Texte: "Céphalée déclenchée par la toux et les efforts"                │
│                                                                         │
│ ATTENDU: htic_pattern = True                                           │
│ OBTENU:  htic_pattern = None                                           │
│                                                                         │
│ CAUSE:                                                                  │
│ - Pattern actuel: "aggrav(ée|ation) (par )?(toux|effort)"              │
│ - Manque pattern: "déclenchée par"                                     │
│                                                                         │
│ SOLUTION À IMPLÉMENTER:                                                 │
│ - Ajouter patterns "déclenchée par" + toux/effort                      │
│ - Ajouter "provoquée par", "causée par"                                │
│ - medical_vocabulary.py L243+                                           │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│ FAIBLESSE #3: Évolution temporelle (absence → présence)                │
├─────────────────────────────────────────────────────────────────────────┤
│ Test: test_evolution_temporelle_absence_puis_presence                  │
│ Texte: "Pas de fièvre hier, mais fébrile ce matin à 38.5"              │
│                                                                         │
│ ATTENDU: fever = True (état actuel doit primer)                        │
│ OBTENU:  fever = False                                                 │
│                                                                         │
│ CAUSE:                                                                  │
│ - "Pas de fièvre" détecté en premier → fever=False                     │
│ - "fébrile ce matin" détecté ensuite mais ne change pas le résultat    │
│ - Ordre de détection influence résultat                                │
│                                                                         │
│ SOLUTION À IMPLÉMENTER:                                                 │
│ - Détecter marqueurs temporels: "hier", "ce matin", "actuellement"     │
│ - Prioriser état "ce matin" > "hier"                                   │
│ - Ou: prendre dernière occurrence chronologique                        │
│ - Ou: détecter "mais" et privilégier partie après                      │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│ FAIBLESSE #4: Durée "3 semaines" mal catégorisée                       │
├─────────────────────────────────────────────────────────────────────────┤
│ Test: test_HTIC_tumeur_cerebrale                                       │
│ Texte: "Céphalée matutinale progressive 3 sem..."                      │
│                                                                         │
│ ATTENDU: profile = "subacute" (7j < 3 sem < 3 mois)                    │
│ OBTENU:  profile = "acute"                                             │
│                                                                         │
│ CAUSE:                                                                  │
│ - Pattern "3 sem" probablement non matché                              │
│ - Durée non extraite → profile par défaut                              │
│                                                                         │
│ SOLUTION À IMPLÉMENTER:                                                 │
│ - Vérifier pattern extraction durée "sem" dans extract_duration_hours  │
│ - nlu.py L848: pattern "\d+ sem" déjà présent mais peut-être ambigu    │
│ - Tester "3 sem" vs "3 semaines" vs "depuis 3 sem"                     │
└─────────────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════
SECTION 2: FAIBLESSES NON-CRITIQUES (Tests passés avec warnings)
═══════════════════════════════════════════════════════════════════════════

Ces tests PASSENT mais révèlent des limitations du modèle actuel:

⚠️  Contexte médical différentiel:
   - "Nuque raide contractures musculaires" → détecté méningé (manque contexte)
   - Solution: analyse contextuelle avancée (hors scope actuel)

⚠️  Expressions rares:
   - "casque de pompier" → détecté correctement
   - "en salves" → non reconnu (cluster headache)
   - Solution: enrichir vocabulaire

⚠️  Acronymes ambigus:
   - AVF = Algie Vasculaire Face vs Accident Voie
   - Actuellement non détecté comme trauma (bon)
   - Solution: analyse contextuelle ("larmoiement" → algie)

⚠️  Double négations:
   - "pas sans fièvre" → détecté False (devrait être True)
   - Solution: parser négations doubles (complexe)

⚠️  Contextes médicaux spécifiques non modélisés:
   - purpura (méningite)
   - claudication mâchoire (Horton)
   - AVK (anticoagulants)
   - VS (vitesse sédimentation)
   - TVC (thrombose veineuse cérébrale)
   → Hors scope modèle actuel (HeadacheCase)

⚠️  Âges extrêmes:
   - "nouveau-né" → âge 50 (défaut)
   - Solution: parser "nouveau-né", "nourrisson", etc.

⚠️  Évolution intensité:
   - "EVA 0 actuellement mais EVA 8 ce matin"
   - Détecte EVA 0 (devrait prendre maximum = EVA 8)
   - Solution: prendre max(EVA) au lieu de dernier

═══════════════════════════════════════════════════════════════════════════
SECTION 3: POINTS FORTS CONFIRMÉS (36/40 tests passés)
═══════════════════════════════════════════════════════════════════════════

✅ ACRONYMES (100% détection):
   - TCC, AVP, RDN+, GCS, VIH+, CGT, PDC → tous détectés
   - Cascade complexe: "F 28a G2P1 22SA TCC J-2 AVP RDN+..." → 100%

✅ VALIDATION NUMÉRIQUE:
   - Fièvre ≥38.0°C strictement appliquée
   - 37.9°C → False ✓
   - 38.0°C → True ✓
   - 38.8°C → True ✓

✅ CAS GOLD STANDARD (100%):
   - HSA typique: onset thunderclap + RDN → 100%
   - Méningite: fièvre + RDN → 100%
   - Migraine: pulsatile + photophobie → 100%
   - Tension: casque bilatéral → 100%

✅ ROBUSTESSE:
   - Texte vide → pas de crash
   - Texte >1000 caractères → détection complète
   - Âge centenaire (103a) → détecté correctement

✅ NÉGATIONS SIMPLES:
   - "sans fièvre" → fever=False ✓
   - "apyrétique" → fever=False ✓
   - "pas de RDN" → meningeal_signs=False ✓

═══════════════════════════════════════════════════════════════════════════
SECTION 4: PRIORITÉS D'AMÉLIORATION
═══════════════════════════════════════════════════════════════════════════

PRIORITÉ 1 (CRITIQUE - Sécurité patient):
┌─────────────────────────────────────────────────────────────────────────┐
│ ✗ Négation + exception ("sans... mais...")                             │
│   → Risque manquer déficit neurologique réel                           │
│   → IMPACT CLINIQUE: Grave (urgence neurologique non détectée)         │
│   → SOLUTION: Parser "mais", "cependant", "sauf" et invalider négation │
└─────────────────────────────────────────────────────────────────────────┘

PRIORITÉ 2 (HAUTE - Diagnostic HTIC):
┌─────────────────────────────────────────────────────────────────────────┐
│ ✗ Déclencheurs HTIC ("déclenchée par toux/effort")                     │
│   → Risque manquer HTIC (tumeur, HSD)                                  │
│   → IMPACT CLINIQUE: Moyen-Grave                                       │
│   → SOLUTION: Ajouter patterns "déclenchée par", "provoquée par"       │
│   → FICHIER: medical_vocabulary.py L243                                │
└─────────────────────────────────────────────────────────────────────────┘

PRIORITÉ 3 (MOYENNE - Qualité clinique):
┌─────────────────────────────────────────────────────────────────────────┐
│ ✗ Évolution temporelle ("hier... ce matin")                            │
│   → État actuel doit primer sur antérieur                              │
│   → IMPACT CLINIQUE: Moyen                                             │
│   → SOLUTION: Détecter marqueurs temporels et prioriser récent         │
└─────────────────────────────────────────────────────────────────────────┘

PRIORITÉ 4 (BASSE - Qualité métadonnées):
┌─────────────────────────────────────────────────────────────────────────┐
│ ✗ Durée "3 sem" → profile subacute                                     │
│   → Impact faible (détecté comme acute fonctionnellement OK)           │
│   → IMPACT CLINIQUE: Faible                                            │
│   → SOLUTION: Vérifier regex extraction "sem" dans extract_duration    │
└─────────────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════
SECTION 5: RECOMMANDATIONS
═══════════════════════════════════════════════════════════════════════════

COURT TERME (1-2 jours):
▶ Corriger PRIORITÉ 1 (négation + exception)
▶ Corriger PRIORITÉ 2 (déclencheurs HTIC)

MOYEN TERME (1 semaine):
▶ Corriger PRIORITÉ 3 (évolution temporelle)
▶ Enrichir vocabulaire expressions rares ("en salves", etc.)

LONG TERME (optionnel):
▶ Analyse contextuelle différentielle (nuque raide musculaire vs méningée)
▶ Double négations ("pas sans")
▶ Modéliser contextes médicaux avancés (purpura, claudication, etc.)

═══════════════════════════════════════════════════════════════════════════
CONCLUSION
═══════════════════════════════════════════════════════════════════════════

Le système NLU v2 est PERFORMANT avec 90% de réussite sur cas complexes.

Les 4 faiblesses identifiées sont:
1. Négation + exception (CRITIQUE)
2. Déclencheurs HTIC (HAUTE)
3. Évolution temporelle (MOYENNE)
4. Durée "3 sem" (BASSE)

➜ Action recommandée: Corriger PRIORITÉS 1-2 avant mise en production.

═══════════════════════════════════════════════════════════════════════════
FICHIER GÉNÉRÉ: 2025-12-06
TEST SOURCE: tests_validation/test_faiblesses_nlu.py (40 tests)
═══════════════════════════════════════════════════════════════════════════
